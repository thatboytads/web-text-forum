<div class="posts-container">
  <header class="header">
    <div class="header-content">
      <div class="logo-section">
        <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="45" stroke="#4CAF50" stroke-width="4"/>
          <path d="M30 50 L45 65 L70 35" stroke="#4CAF50" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </svg>
        <h1>TruthForum</h1>
      </div>
      <div class="user-section">
        <span *ngIf="isModerator" class="moderator-badge">Moderator</span>
        <button (click)="logout()" class="logout-button">Logout</button>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="create-post">
      <h2>Create a Post</h2>
      <input
        type="text"
        [(ngModel)]="newPostTitle"
        placeholder="Post title"
        class="post-input"
        [disabled]="isCreatingPost"
      />
      <textarea
        [(ngModel)]="newPostContent"
        placeholder="Write your post..."
        class="post-textarea"
        [disabled]="isCreatingPost"
      ></textarea>
      <button
        (click)="createPost()"
        class="submit-post-button"
        [disabled]="!newPostTitle.trim() || !newPostContent.trim() || isCreatingPost"
      >
        {{ isCreatingPost ? 'Posting...' : 'Post' }}
      </button>
    </div>

    <div *ngIf="loading$ | async" class="loading">Loading posts...</div>

    <div *ngIf="(error$ | async) as error" class="error-message">
      {{ error }}
    </div>

    <div class="posts-list">
      <div
        *ngFor="let post of posts"
        class="post-card"
        [class.misleading]="post.is_misleading"
      >
        <!-- Misleading label -->
        <div *ngIf="post.is_misleading" class="misleading-label">
          ‚ö†Ô∏è Misleading or False Information
        </div>

        <!-- Post header -->
        <div class="post-header">
          <h2 class="post-title">{{ post.title }}</h2>
          <span class="post-date">{{ formatDate(post.created_at) }}</span>
        </div>

        <!-- Post content -->
        <div class="post-content">
          {{ post.content }}
        </div>

        <!-- Post actions -->
        <div class="post-actions">
          <!-- Like button -->
          <div class="action-group">
            <button
              (click)="likePost(post.id)"
              class="action-button like-button"
              [class.liked]="hasLiked(post.id)"
              [disabled]="hasLiked(post.id)"
            >
              <span class="icon">üëç</span>
              <span class="count">{{ post.likes_count }}</span>
              <span class="label">{{ hasLiked(post.id) ? 'Liked' : 'Like' }}</span>
            </button>
          </div>

          <!-- Comments toggle -->
          <div class="action-group">
            <button
              (click)="toggleComments(post.id)"
              class="action-button comment-button"
            >
              <span class="icon">üí¨</span>
              <span class="count">{{ post.comments.length }}</span>
              <span class="vibe-badge">{{ getVibe(post.id).emoji }} {{ getVibe(post.id).label }}</span>
              <span class="label">{{ isCommentsExpanded(post.id) ? 'Hide Comments' : 'Show Comments' }}</span>
            </button>
          </div>

          <!-- Moderate button (moderator only) -->
          <div class="action-group" *ngIf="isModerator">
            <button
              (click)="markAsMisleading(post.id)"
              class="action-button moderate-button"
              [class.active]="post.is_misleading"
            >
              <span class="icon">‚ö†Ô∏è</span>
              <span class="label">{{ post.is_misleading ? 'Mark Accurate' : 'Mark Misleading' }}</span>
            </button>
          </div>
        </div>

        <!-- Comments section -->
        <div *ngIf="isCommentsExpanded(post.id)" class="comments-section">
          <div class="comments-list">
            <div *ngIf="post.comments.length === 0" class="no-comments">
              No comments yet. Be the first to comment!
            </div>

            <div *ngFor="let comment of post.comments" class="comment">
              <div class="comment-content">{{ comment.content }}</div>
              <div class="comment-meta">
                <span class="comment-author">User #{{ comment.author_id }}</span>
                <span class="comment-date">{{ formatDate(comment.created_at) }}</span>
              </div>
            </div>
          </div>

          <!-- Add comment -->
          <div class="add-comment">
            <input
              type="text"
              [(ngModel)]="newCommentContent[post.id]"
              placeholder="Write a comment..."
              class="comment-input"
              (keyup.enter)="addComment(post.id)"
            />
            <button
              (click)="addComment(post.id)"
              class="submit-comment-button"
              [disabled]="!newCommentContent[post.id] || !newCommentContent[post.id].trim()"
            >
              Post
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!(loading$ | async) && posts.length === 0" class="no-posts">
      <p>No posts available yet.</p>
    </div>
  </main>
</div>
